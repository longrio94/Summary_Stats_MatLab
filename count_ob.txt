SELECT
    t1.peil_dt,
    COUNT(DISTINCT t1.account_id) AS total_accounts_table1,
    COUNT(DISTINCT CASE WHEN t2.account_id IS NOT NULL THEN t1.account_id END) AS matching_accounts,
    (COUNT(DISTINCT CASE WHEN t2.account_id IS NOT NULL THEN t1.account_id END) * 100.0) / COUNT(DISTINCT t1.account_id) AS percentage_match
FROM
    table1 t1
LEFT JOIN
    table2 t2
    ON t1.account_id = t2.account_id
    AND t1.peil_dt = t2.peil_dt
GROUP BY
    t1.peil_dt
ORDER BY
    t1.peil_dt;
